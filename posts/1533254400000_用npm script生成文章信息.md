[mTime]:#(1534521862987)
<!---
终于，我们要开始脱离全手动添加文章信息，进入几乎就要全自动的时代了。
--->
# 目标
## 用脚本将文章信息写进posts.json里
### 文章信息

* 标题---文件名
* 创建时间---stats.birthtime
* 修改时间---stats.mtime
* 摘要---用注释写在开头

### 流程

* 创建对象数组posts
	* 遍历md文件
	* 把文件信息加进对象数组
		* 赋值标题
		* 赋值创建时间
		* 赋值修改时间
		* 赋值摘要
	* 根据创建时间降序排序
* 把对象数组写为posts.json

## 自动执行脚本和webpack,当md文件和js文件有改动时 

### 思路
用某个工具监测指定文件夹和类型的文件，变动后，自动执行指定script。  
其实最好能分开来监测，当md文件变动之后，只执行写入文章信息的命令。  
当js文件变动之后，只执行webpack命令。  
但是onchange好像不支持，别的我又不会，只能每次都执行一遍了。


# 难点  

## 记摘要
想用注释的方式，把摘要放到注释里面
### 注释方式
这里花了很多时间

* 一开始用`[comment]: <> (This is a comment, it will not be included)`
	* 但是得把摘要改成一行，这样不好看也不好记。  
* 然后用
```
	[^summary]:
	This is a comment
	it will not be included

	·sublime的markdown preview插件是可以都不显示的，但showdown只是不显示第一行
```
* 最后用`<!---comment--->`
	* 虽然它会显示在html文档里，但基本功能达到了

## 读摘要
主要卡在换行和匹配文字上。肯定是用正则表达式的。  
这是最后能用的`/^<!---(\r\n|\n)([^]*?)(\r\n|\n)--->/`
### 换行
了解了一下多行模式，好像是用来把每一行都当作一个字符串来匹配的，并不是把多行当一个字符串。  
得直接用换行符去匹配，windows下和Linux下不一样，把两种换行符用`()` 包起来，用`|`隔开，应该就都能匹配了。  
### 匹配文字和标点符号
我一开始以为需要把中间的中文和标点符号都标记出来，后来发现用`([^]*?)`就行，因为有`<!---`和`--->`来限定边界，所以中间的玩意儿可以随便一点
## 路径问题
在使用npm script运行js文件时，出现了路径错误。这使我联想到别人在`fs.readdir`之类的需要输入路径的地方，都是要`require('path')`，再用`path`去生成路径的，而不是跟我之前一样直接写相对路径，于是就搜到了一篇[讲解文件路径的文章](https://github.com/imsobear/blog/issues/48)  
看了之后就大概了解了

* `require`里的路径，是以当前运行的js文件为基础的
* 别的地方的路径，可能是以执行命令时的文件夹为基础的，最好还是都用`path`来统一一下

## 监视文件问题
### 监测工具
#### onchange
简单，但是不能分开监测、分开执行
#### nodemon
好像主要功能是代替node命令，附带有watch功能，但是我安装以后运行总是有错，也不太会用，还是真的需要的时候在研究吧。
#### webpack
好像在开发模式下会自动watch，但是我找不到自定义文件变动后执行命令的地方
### 操作互相影响
#### js文件位置
一开始我自定义js是放在src里的，但是好像会影响整个流程，于是把它放到专门的文件夹里。  
但是改了位置之后，居然告诉我说找不到这个模块了！  
我试了一下，好像在这个项目文件夹里，它就是找不到别的文件夹里的js文件的，只能放在src，或者项目根目录里。  
我在另外的地方建一个项目文件夹试了试，同样的目录结构，都是能找到的。  
唯独在这个项目文件夹里用`node *.js`命令就找不到。真的是见了鬼了。  
时间已经晚了，我就去睡觉了，睡觉的时候觉得可能是node命令所用的module.js被webpack修改过了，想着第二天可能得了解了解node命令的具体流程，虽然它的使用方式就跟cd命令一样简单。  
第二天，我刚开始没有直接去解决这个问题，因为反正放根目录里能读，那就先放着，我去看webpack server去了，在看的时候，顺便看到了和node相关的内容，好像是说可以修改node module什么的，我想可能和这个有关，就想试试。  
结果发现不改动，也能找到模块了...真的是见鬼了，我也没重启也没做别的事，睡个觉就行了。
#### webpack影响
因为有的时候会连续执行好几次自己写的js，有的时候又挺正常。  
我就觉得webpack可能和onchange有影响，可能在预编译的时候会修改文件，又让onchange抓到了。  
但是后面几次又没这个问题了，我也就算了...
### onchange有时候没反应
需要在命令窗口里随便按个键，才会自动执行。  
也是一样，后面就没发现这个问题了，也不知道原因是什么...
### server
我本来想让nodejs来当server,然后就能实时更新，顺便可以自动执行自己写的js。  
我找了一个叫webpack-dev-server的，它可以当服务器，但是我找不到执行自己脚本的方法，有个看起来能用的方法，但是搜不到例子，搜到了例子也看不懂它在干嘛，反而还看到了一堆没见过的单词，还是算了吧。。。  
在看webpack文档的时候，发现自己几乎不了解它，确实我只会用最基本的。可能以后可以靠教程慢慢了解那些东西吧。。。

> 这整个过程消耗了我大量时间和精力，超出了我预期的时间。  
让我不知道怎么调整后面的事...

